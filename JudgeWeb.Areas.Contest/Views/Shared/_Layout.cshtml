@{ 
    Contest cont = ViewBag.Contest;;
    var initial = DateTimeOffset.Now.ToUnixTimeMilliseconds();
    var now = initial / 1000;
    var startTime = cont.StartTime is null ? -1 : cont.StartTime.Value.ToUnixTimeSeconds();
    var endTime = cont.EndTime is null ? -1 : cont.EndTime.Value.ToUnixTimeSeconds();
    var prog = startTime == -1 || initial / 1000 < startTime ? 0
        : now >= endTime ? 100 : (now - startTime) * 100 / (endTime - startTime);
    if (!ViewData.ContainsKey("RefreshSpan")) { ViewData["RefreshSpan"] = 30; }
}

<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>@ViewData["Title"] - @cont.Name</title>
    <meta name="viewport" content="initial-scale=1, user-scalable=no">
    <environment include="Development">
        <link rel="stylesheet" href="~/static/css/bootstrap.css" />
        <link rel="stylesheet" href="~/static/site/domjudge.css" />
        <link rel="stylesheet" href="~/static/css/fontawesome.min.css" />
        <script src="~/static/js/jquery.js"></script>
        <script src="~/static/js/bootstrap.bundle.js"></script>
        <script src="~/static/site/xylab.js"></script>
        <script src="~/static/site/domjudge.js"></script>
    </environment>
    <environment exclude="Development">
        <link rel="stylesheet" href="~/static/css/bootstrap.min.css" />
        <link rel="stylesheet" href="~/static/site/domjudge.css" />
        <link rel="stylesheet" href="~/static/css/fontawesome.min.css" />
        <script src="~/static/js/jquery.min.js"></script>
        <script src="~/static/js/bootstrap.bundle.min.js"></script>
        <script src="~/static/site/xylab.js"></script>
        <script src="~/static/site/domjudge.js"></script>
    </environment>
</head>

<body>
    <div id="append-parent"></div>
    <!-- #header start -->
    <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
        <a class="navbar-brand hidden-sm-down" aria-label="AcmXylabFun" asp-action="Home">
            <svg xmlns="http://www.w3.org/2000/svg" class="d-none d-md-block" viewBox="0 0 37.1 38.22" focusable="false" width="28" height="29">
                <path fill="currentColor" d="M53.75,66c.25.37.79.87.79,1.47v1.13a6.88,6.88,0,0,1-2.25,4.26,7.35,7.35,0,0,1-4.88,1.69c-2.52,0-6.2-1.8-7.93-2.72a10.41,10.41,0,0,1-2.08,1.55,9.6,9.6,0,0,1-1.23.58,12.76,12.76,0,0,1-1.51.31H34a2.94,2.94,0,0,1-1.76-.68c-.58-.38-.9-1-1.25-1.25-1.2,0-2.6-.38-2.83-1.25H48.48a4.64,4.64,0,0,0,4.36-4.53V59.11c.75.2,2.66,2.33,2.66,3.45v.79A4.39,4.39,0,0,1,53.75,66Zm-34-17.27V67c.06.1.36,1.24.55,1.6a3.68,3.68,0,0,0,.91,1.18,4.42,4.42,0,0,0,2.9,1.29H27a3.36,3.36,0,0,0,1.3,1.64,3.49,3.49,0,0,0,2.32.62,4.87,4.87,0,0,0,3.68,2.1h.11a7.59,7.59,0,0,0,3-.75,8.46,8.46,0,0,0,2.28-1.45c1.53.81,5,2.32,7.19,2.32,3.07,0,4.41-.39,6.21-1.72a7.44,7.44,0,0,0,2.69-5.19V67.55A3.26,3.26,0,0,0,55.11,66a13.56,13.56,0,0,0,1.15-1.4,4,4,0,0,0,.55-2,4.76,4.76,0,0,0-1.43-3,10.68,10.68,0,0,0-2.53-1.88v1.3c-.12,0-1.28-.91-1.49-1.06a10.62,10.62,0,0,0-1.59-.9,8.89,8.89,0,0,0-4-1h-.11a6.68,6.68,0,0,0-2.9.9,8.42,8.42,0,0,0-1.08.85,11.85,11.85,0,0,1-.89,1c-.07-.83-.81-2.32-1.64-2.32h-.45c-1,0-2.26,1.44-2.61,1.53a4.78,4.78,0,0,0-1.2-2.25,2.75,2.75,0,0,0-2.48-.86c-1.66.07-4,1.31-4,2.94v.06a2.67,2.67,0,0,0,.28,1.25c.13.26.53.82.57,1-1,.23-3.68,2-3.68,3.11v.06c0,1.5,2.71,2.23,3.85,2.77a7.73,7.73,0,0,0-1.59,3.74v.34c0,.47.2.64.23,1h-1c-.24,0-.4-.72-.4-1V69.3A5.35,5.35,0,0,1,27,67.69c.15-.54.45-1,.53-1.34a7.78,7.78,0,0,1-2.11-1.06c-.46-.43-1.23-1-1.23-1.88v-.28c0-1.48,2.38-3.23,3.45-3.79a6.45,6.45,0,0,1-.45-1.47v-.62c0-1.91,2.71-3.68,4.7-3.68h.74a4.29,4.29,0,0,1,2.5.78c.46.34,1.38,1.12,1.52,1.71.16,0,.88-.52,1.21-.66A5.55,5.55,0,0,1,39.31,55h.4a1.94,1.94,0,0,1,1.76,1.59,21.9,21.9,0,0,1,1.81-1.25,5.65,5.65,0,0,1,2.49-.51,9.83,9.83,0,0,1,4,1,11.3,11.3,0,0,1,1.62.87c.45.3,1,.78,1.48,1q0-4.36,0-8.72a4.64,4.64,0,0,0-4.36-4.36H24.19a4.61,4.61,0,0,0-3,1.26,4.82,4.82,0,0,0-.92,1.23,6.44,6.44,0,0,0-.32.76,6.09,6.09,0,0,1-.19.83Z" transform="translate(-19.71 -44.61)" />
                <path fill="currentColor" d="M37.27,77.12c0-.69.9-1.19,1.64-1.19h.28c.64,0,1.53.59,1.53,1.19v.06c0,.64-.89,1.19-1.64,1.19h-.17c-.77,0-1.64-.52-1.64-1.25Zm-1.13,0a2.63,2.63,0,0,0,2.78,2.38h.34a2.6,2.6,0,0,0,2.55-2.27v-.11c0-1.44-1.41-2.32-2.89-2.32a2.67,2.67,0,0,0-2.78,2.32Z" transform="translate(-19.71 -44.61)" />
                <path fill="currentColor" d="M32.06,79.27a1.25,1.25,0,0,1,1.3-1.08h.11c.61,0,1.3.46,1.3,1s-.64,1-1.19,1h-.28c-.56,0-1.25-.37-1.25-.91Zm1.3,2c1.32,0,2.49-.68,2.49-2V79c0-1.14-1.26-2-2.49-2-1.07,0-2.38.92-2.38,1.81v.62c0,1,1.27,1.81,2.38,1.81Z" transform="translate(-19.71 -44.61)" />
                <path fill="currentColor" d="M27.47,80.46c0-.28.39-.34.68-.34h.62c.19,0,.51.15.51.34v.06c0,.25-.47.4-.74.4h-.34c-.27,0-.74-.14-.74-.4v-.06Zm-1.13.11A1.64,1.64,0,0,0,27.81,82h1.13a1.59,1.59,0,0,0,1.47-1.53c0-1-.92-1.47-2-1.47H28a1.62,1.62,0,0,0-1.64,1.59Z" transform="translate(-19.71 -44.61)" />
                <path fill="currentColor" d="M23.17,81.42a.22.22,0,0,1,.23-.23h.34c.25,0,.68,0,.68.28s-.24.23-.4.23h-.51c-.17,0-.34-.05-.34-.23v-.06ZM24,82.84a1.5,1.5,0,0,0,1.59-1.42c0-1-1-1.36-2-1.36h-.06c-.67,0-1.42.5-1.42,1.13v.34a1.28,1.28,0,0,0,1.36,1.3Z" transform="translate(-19.71 -44.61)" />
            </svg>
            <span class="d-md-none" style="font-variant:small-caps;">@cont.ShortName</span>
        </a>

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#menuDefault"
                aria-controls="menuDefault" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="menuDefault">
            <partial name="_Navigation" />

            <div class="navbar-text" style="white-space:nowrap;">
                <i style="padding-left: 10px;" class="fas fa-clock"></i>
                <span id="timeleft"></span>
            </div>

            <script>
                var initial = @now;
                var activatetime = 1500000000;
                var starttime = @startTime;
                var endtime = @endTime;
                var offset = 0;
                var date = new Date(@initial);
                var timeleftelt = document.getElementById("timeleft");

                setInterval(function () {
                    updateClock();
                }, 1000);
                updateClock();
            </script>
        </div>
    </nav>
    <partial name="_ProgressBar" model="prog" />
    <!-- #content start -->
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                @RenderSection("Header", required: false)
                @if (ViewData.ContainsKey("DisableAjaxRefresh"))
                {
                    @RenderBody()
                }
                else
                {
                    <div data-ajax-refresh-target data-ajax-refresh-after="@ViewData["RefreshAfter"]" data-ajax-refresh-before="@ViewData["RefreshBefore"]" class="@ViewData["DataAjaxClass"]">
                        @RenderBody()
                    </div>
                }
            </div>
        </div>
    </div>
    <!-- #content end -->
    <div id="ajax_append"></div>

    <aside class="col-md-4 col-xl-3" id="notification-box"></aside>
    <script>var domjudge_base_url = "/contest/@ViewData["ContestId"]";</script>

    @if (!ViewData.ContainsKey("DisableAjaxRefresh"))
    {
        <script>
            $(function () {
                /* toggle refresh if set */
                $('#refresh-navitem').on('click', function() {
                    toggleRefresh('@Html.Raw(ViewData["RefreshUrl"])', @ViewData["RefreshSpan"], 1);
                });

                /* Enable page refresh if set if wanted by the page, and wanted by the user */
                enableRefresh('@Html.Raw(ViewData["RefreshUrl"])', @ViewData["RefreshSpan"], 1);
            });
        </script>
    }

    @RenderSection("Scripts", required: false)
</body>
</html>
